{%extends 'medium_scrap/base.html' %}
{%block content%}
<div class="container">
{%if not user.is_authenticated %}

{%else%}
    <br>
    <h1>Search History</h1>
    <hr>
    <ul class='list-group list-group-horizontal'>
        {%for obj in history%}
            <li class="list-group-item">{{obj.tag.keyword}}</li>
        {%endfor%}
    </ul>

{%endif%}
</div>
{%endblock%}
{%block tagscript%}
<script type="text/javascript">
    let page = 0;
    $('#keyform').submit(function logSubmit(event) {
        event.preventDefault();
        var csrf = $('input[name=csrfmiddlewaretoken]').val();
        let keyword = $('#keyword').val();
        $.ajax({
            method: "POST",
            url: `/tags_query/${keyword}/${page}`,
            data: {'csrfmiddlewaretoken': csrf}
        }).done(function(response){
            let sim_tags = response.sim_tags;
            let blog_list = response.blog_list;
            let innerhtml = "<br><h2>Tags related to your search:</h2><hr><ul class='list-group list-group-horizontal'>";
            for(let i=0;i<sim_tags.length;i++){
                innerhtml+="<li class='list-group-item'>"+sim_tags[i]+"</li>";
            }
            innerhtml+="</ul><br><h1>Your Search results:</h1><br>"
            for(let i=0;i<blog_list.length;i++){
                let title = blog_list[i]['heading'];
                let sub_head = blog_list[i]['sub_head'];
                let url = blog_list[i]['url'];
                let author = blog_list[i]['author_name'];
                innerhtml+="<div class='card'><div class='card-body'><h5 class='card-title'>"+title+"</h5><h6 class='card-subtitle mb-2 text-muted'>"+sub_head+"</h6><p class='card-text'>By "+author+"</p></div></div>"
            }
            $('.container').html(innerhtml);
        })
    });

</script>
{%endblock%}